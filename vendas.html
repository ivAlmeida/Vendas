<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>RelatÃ³rio de Vendas - Doces do Ivan</title>
    <style>
        body { font-family: sans-serif; background: #f4f4f4; padding: 20px; }
        .container { max-width: 900px; margin: auto; background: white; padding: 20px; border-radius: 8px; }
        h1 { color: #008f39; text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background: #008f39; color: white; }
        .total-destaque { font-size: 1.2em; font-weight: bold; color: #008f39; margin-top: 20px; text-align: right; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸ“Š RelatÃ³rio de Vendas</h1>
        <div id="vendas-lista">Carregando...</div>
        <div class="total-destaque" id="lucro-total">Total: R$ 0,00</div>
    </div>

    <script>
        const URL = "https://ccoakkvpawzzwvryrxun.supabase.co/rest/v1/resumo_vendas?select=*";
        const KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNjb2Fra3ZwYXd6end2cnlyeHVuIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc3MTc4ODkyNSwiZXhwIjoyMDg3MzY0OTI1fQ.BL0drxTfBPkNqwF75gMAkZtibBcwvV7g_B55-5ZCz14"; // Use a mesma Key do Mural

        async function carregarVendas() {
            const res = await fetch(URL, {
                headers: { "apikey": KEY, "Authorization": `Bearer ${KEY}` }
            });
            const dados = await res.json();
            
            let html = '<table><tr><th>Data</th><th>Cliente</th><th>Doce</th><th>Qtd</th><th>Total</th></tr>';
            let somaTotal = 0;

            dados.forEach(v => {
                const dataFormatada = new Date(v.data_venda).toLocaleDateString('pt-BR');
                somaTotal += parseFloat(v.valor_total);
                html += `<tr>
                    <td>${dataFormatada}</td>
                    <td>${v.nome_cliente} (${v.local})</td>
                    <td>${v.nome_doce}</td>
                    <td>${v.quantidade}</td>
                    <td>R$ ${parseFloat(v.valor_total).toFixed(2)}</td>
                </tr>`;
            });

            html += '</table>';
            document.getElementById('vendas-lista').innerHTML = html;
            document.getElementById('lucro-total').innerHTML = `Faturamento Total: R$ ${somaTotal.toFixed(2)}`;
        }
        carregarVendas();
    </script>
</body>
</html>
